---
title: 移动页面开发适配方案(上)
date: 2017-01-21 15:19:51
tags: H5
categories: Daily
excerpt: 在现如今，那么多手机，大小各不相同，如何让h5页面在各种手机上展现的几乎一样呢？
cover: http://caiguofeng.com/uploads/allimg/160819/1-160Q9111Q2436.jpg
---

[toc]

**相关文章**

- [移动页面开发适配方案(上)](http://www.blackcater.win/2017/01/21/移动页面开发适配方案-上/)
- [移动页面开发适配方案(下)](http://www.blackcater.win/2017/01/22/移动页面开发适配方案-下/)

## 基础知识

在真正介绍解决方案之前，你需要知道一些设计方面的基础知识，对你继续阅读后面的内容有很大的帮助！

### 视窗(viewport)

简单的理解，viewport是严格等于浏览器的窗口。在桌面浏览器中，viewport就是浏览器窗口的宽度高度。但在移动端设备上就有点复杂。

移动端的viewport太窄，为了能更好为CSS布局服务，所以提供了两个viewport: `visual viewport`和`layout viewport`。

George Cummins在Stack Overflow对这两者进行了形象的解释[详情点击](http://stackoverflow.com/questions/6333927/difference-between-visual-viewport-and-layout-viewport)

翻译过来意思大概是这样：

> 想象下`layout viewport`是一张大的不能改变大小和角度的图片。现在你有个更小的框来观看这张大图片，这个框被不透明的材料包围，因而你只能看到大图片的一部分。你通过这个框子看到的大图片的部分被称为`visual viewport`。你能拿着这个框站得离大图片远点（用户的缩小页面功能），以一次性看到这个大图片。或者你能站得近点（用户的放大页面功能）以看到一部分。你能改变这个框子的方向，但这张大图片的大小和形状都不会改变。 -----  George Cummins


### 物理像素(physical pixel)

物理像素又被称为设备像素(device pixel)，他是显示设备中一个最微小的物理部件。每个像素可以根据操作系统设置自己的颜色和亮度。正是这些设备像素的微小距离欺骗了我们肉眼看到的图像效果。

### 设备独立像素(density-independent pixel)

设备独立像素也称为密度无关像素，可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用的虚拟像素(比如说CSS像素)，然后由相关系统转换为物理像素。

### CSS像素

CSS像素是一个抽像的单位，主要使用在浏览器上，用来精确度量Web页面上的内容。一般情况之下，CSS像素称为与设备无关的像素(device-independent pixel)，简称DIPs。

### 屏幕密度

屏幕密度是指一个设备表面上存在的像素数量，它通常以每英寸有多少像素来计算(PPI)。

### 设备像素比(device pixel ratio)

设备像素比简称为dpr，其定义了物理像素和设备独立像素的对应关系。它的值可以按下面的公式计算得到：

```
    设备像素比(dpr) ＝ 物理像素(device pixel) / 设备独立像素(DIPs)
```

在JavaScript中，可以通过`window.devicePixelRatio`获取到当前设备的dpr。

而在CSS中，可以通过`-webkit-device-pixel-ratio`，`-webkit-min-device-pixel-ratio`和 `-webkit-max-device-pixel-ratio`进行媒体查询，对不同dpr的设备，做一些样式适配(这里只针对webkit内核的浏览器和webview)。

一张图解释上面含义：

<p><img src="https://camo.githubusercontent.com/a407f9dc63ca26a60ade9ed8830713c14f6132d8/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f3230313231322f726574696e612d7765622d332e6a7067" alt="dpr" data-action="zoom"></p>

就拿iPhone6来举例子，其设备宽度和高度为`375pt * 667pt`，其`dpr = 2`。所以，iPhone6的物理像素为`750pt * 1334pt`。

## 百分比方案

在现如今，很多网站都会使用百分比进行布局。

然而百分比布局有个头疼的地方是，其大小是相对于父元素进行计算的，那么一个设计稿给你了，自己去算相对于父元素大小，我想，是个人都想死的吧！即使这都是一些很简单的数学计算。

现在css支持`vh`和`vw`，将viewport宽度和高度分成100份，`100vw`就是整个视图宽度，同理`100vh`就是整个视图高度。使用`vh`和`vw`进行布局就比原先方便许多了。我们只需要去算该元素是整个视图的百分之几就行了，不用再相对父元素这么头疼了。

然而不幸的是，`vw`和`vh`的支持情况却不是那么完美(默默哭一会/(ㄒoㄒ)/~~)

<p><img src="http://oameisqha.bkt.clouddn.com/14849883773584.jpg" alt="can-i-use__vw" data-action="zoom"></p>

从上图我们可以看到，安卓低版本是不支持`vw`的，然而安卓`4.3`版本可是很**神奇**的版本，现在依旧有很多人安卓手机运行的是4.3版本的安卓系统。

## `rem`

### 什么是`rem`

这里要谈论的适配方案是基于`rem`进行多终端适配的。

`rem`的支持情况可是比上面讲到的`vw`和`vh`好了很多。

<p><img src="http://oameisqha.bkt.clouddn.com/14849892390485.jpg" alt="can-i-use__rem" data-action="zoom"></p>

在理解`rem`之前，你需要知道`em`。

`em`是相对于当前字体大小而计算的，比如：当前字体大小为`10px`，那么`1em = 10px`，`2em`就是`20px`。

`rem`的第一个字母`r`是`root`，意思不言而喻，就是相对于==根==，==根==指哪？那就是`html`元素的`font-size`大小为基准进行计算的。

### 如何适配？

我们现在使用了`rem`，要使得我们写的css代码，在每个设备上都显示的一样，那么我们不得不去设置各个设备下的`rem`基准值。

在淘宝，天猫，计算这个基准值的公式是：

```
    1rem = ((设置宽度 * dpr) / 10)px
```

例如：以iPhone6为例子，iPhone6设备宽度为`375pt`，`dpr = 2`那么，其`1rem = 75px`。

这里的除以10是数值上的处理。

这时候，我们拿到iPhone6`750pt * 1334pt`大小的设计稿的时候，我们量出`px`值，咔咔咔除以`75`就能得到对应`rem`。

这时候，你可能有个疑问，设计稿是750，然而手机只是375对不对？

这里你将设计稿理解为`layout viewport`，而手机可视的375大小理解为`visual viewport`。这里需要对视图进行相应的缩小

```
    scale(缩小值) = 1 / dpr(device pixcel ratio)
```

我们设置`meta`值就行

```html
    <!-- scale 为上面计算的值 -->
    <meta name="viewport" content="width=device-width,initial-scale='+ scale +',minimum-scale='+ scale + ',user-scalable=no">
```

`meta`标签和`rem`基准值都是通过js代码计算和动态添加的。

### 文本字号不建议使用`rem`

前面大家都见证了如何使用`rem`来完成H5适配。那么文本又将如何处理适配。是不是也通过`rem`来做自动适配。

显然，我们在iPhone3G和iPhone4的Retina屏下面，希望看到的文本字号是相同的。也就是说，我们不希望文本在Retina屏幕下变小，另外，我们希望在大屏手机上看到更多文本，以及，现在绝大多数的字体文件都自带一些点阵尺寸，通常是16px和24px，所以我们不希望出现13px和15px这样的奇葩尺寸。

如此一来，就决定了在制作H5的页面中，`rem`并不适合用到段落文本上。所以在Flexible整个适配方案中，考虑文本还是使用px作为单位。只不过使用[data-dpr]属性来区分不同dpr下的文本字号大小。


*文章参考:*
- *[viewports剖析](http://www.w3cplus.com/css/viewports.html)*
- *[使用Flexible实现手淘H5页面的终端适配](https://github.com/amfe/article/issues/17)*

*转载注明出处*
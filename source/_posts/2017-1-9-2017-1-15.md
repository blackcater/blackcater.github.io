---
title: 2017/1/9 - 2017/1/15
date: 2017-01-09 21:41:16
categories: Daily
excerpt: 2017年1月9号到15号遇到问题总结
cover: /img/banner-4.png
---

<!-- toc -->

## 1月9日

### 音频和视频播放器

今天主要工作是封装一个 视频播放器 和 音频播放器。开发框架为`react`。这两个组件 现在是用于 公司的一个 文章编辑器中，用于视频和音频的预览。

正如大家可以想象的：

- 视频播放器：暂停/播放，进度条，进度调节，音量调节，全屏播放
- 音频播放器：暂停/播放，进度条，进度调节，音量调节

猛然一看是不是一样的？其实，就是一样的。也就样式不一样。大部分代码都一样。

#### 暂停/播放

这个很简单，通过组件内的一个状态进行控制。

#### 进度条

进度条，如果需要支持 滑动调节，那么你需要监听 `mousedown`，`mousemove`, `mouseup`。 

移动`div`的思想就是可以用到这了。

#### 音量调节

和进度条调节一样

#### 全屏播放

这个确实是坑了自己很久。因为原来从没有做过。

由于是自定义的视频播放器，`video`放在最外层的`div`里

```html
    <div ref="palyer">
        <video src={src} controls={false}>Your browser can't support play this video. Please use more advanced browser!</video>
    </div>
```

全屏的时候，是给`this.refs.palyer`进行全屏。 幸运的是，浏览器是支持的。

```js
    // Supports most browsers and their versions.
    var requestMethod = element.requestFullScreen ||
                        element.webkitRequestFullScreen ||
                        element.mozRequestFullScreen ||
                        element.msRequestFullScreen

    if (requestMethod) {
        // Native full screen.
        requestMethod.call(element)
    } else if (typeof window.ActiveXObject !== "undefined") {
        // Older IE.
        var wscript = new ActiveXObject("WScript.Shell")
        if (wscript !== null) {
            wscript.SendKeys("{F11}")
        }
    }
```

有进入全屏，就有退出的方法

```javascript
    var cancelMethod = document.exitFullscreen ||
                       document.msExitFullscreen ||
                       document.mozCancelFullScreen ||
                       document.oCancelFullScreen ||
                       document.webkitExitFullscreen

    if (cancelMethod) {
        cancelMethod()
    }
```

当进入全屏状态之后，大部分浏览器都会提示说：`按ESC可推出全屏`。当用户按`esc`键的时候，我们需要修改组件内的`state`，以确保呈现的样式是对的。

所以，我们需要要对全屏变化操作进行监听。

```javascript
  componentDidMount() {
    addEvent(document, 'fullscreenchange', this.escKeyHandler) // standard
    addEvent(document, 'mozfullscreenchange', this.escKeyHandler) // mozilia
    addEvent(document, 'webkitfullscreenchange', this.escKeyHandler) // webkit Safari Chrome
    addEvent(document, 'msfullscreenchange', this.escKeyHandler) // microsoft IE
  }

  componentWillUnmount() {
    removeEvent(document, 'fullscreenchange', this.escKeyHandler)
    removeEvent(document, 'mozfullscreenchange', this.escKeyHandler)
    removeEvent(document, 'webkitfullscreenchange', this.escKeyHandler)
    removeEvent(document, 'msfullscreenchange', this.escKeyHandler)
  }
```

### 图片/音频/视频上传

这个没难度。在使用`draft-js`(以后会抽时间写一个教程)进行该功能开发的时候，遇到了一个有点头疼的问题。

就是 需要 清除 `input` 元素原来的数据。其实很简单：`$input.value = ''`


## 1月10日

TO BE CONTINUE....
